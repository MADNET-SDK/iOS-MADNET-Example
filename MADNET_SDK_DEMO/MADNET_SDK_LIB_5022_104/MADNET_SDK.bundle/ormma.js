(function(){var e=window.ormma={};var t=e.STATES={UNKNOWN:"unknown",DEFAULT:"default",RESIZED:"resized",EXPANDED:"expanded",HIDDEN:"hidden"};var n=e.EVENTS={ASSETREADY:"assetReady",ASSETREMOVED:"assetRemoved",ASSETRETIRED:"assetRetired",ERROR:"error",INFO:"info",HEADINGCHANGE:"headingChange",KEYBOARDCHANGE:"keyboardChange",LOCATIONCHANGE:"locationChange",NETWORKCHANGE:"networkChange",ORIENTATIONCHANGE:"orientationChange",RESPONSE:"response",SCREENCHANGE:"screenChange",SHAKE:"shake",SIZECHANGE:"sizeChange",STATECHANGE:"stateChange",TILTCHANGE:"tiltChange",MRAIDREADY:"ready",MRAIDVIEWABLECHANGE:"viewableChange"};var r=e.CONTROLS={BACK:"back",FORWARD:"forward",REFRESH:"refresh",ALL:"all"};var i=e.FEATURES={LEVEL1:"level-1",LEVEL2:"level-2",LEVEL3:"level-3",SCREEN:"screen",ORIENTATION:"orientation",HEADING:"heading",LOCATION:"location",SHAKE:"shake",TILT:"tilt",NETWORK:"network",SMS:"sms",PHONE:"phone",EMAIL:"email",CALENDAR:"calendar",CAMERA:"camera",AUDIO:"audio",VIDEO:"video",MAP:"map"};var s=e.NETWORK={OFFLINE:"offline",WIFI:"wifi",CELL:"cell",UNKNOWN:"unknown"};var o=t.UNKNOWN;var u={width:0,height:0};var a={x:0,y:0,width:0,height:0};var f={width:0,height:0};var l={"level-1":true,"level-2":true,"level-3":true,screen:true,orientation:true,heading:true,location:true,shake:true,tilt:true,network:true,sms:true,phone:true,email:true,calendar:true,camera:true,audio:true,video:true,map:true};var c=-1;var h=false;var p=null;var d=s.UNKNOWN;var v=-1;var m=null;var g=null;var y=null;var b={};var w=-1;var E=false;var S=null;var x=1e4;var T=0;var N={x:function(e){return!isNaN(e)&&e>=0},y:function(e){return!isNaN(e)&&e>=0},width:function(e){return!isNaN(e)&&e>=0&&e<=m.width},height:function(e){return!isNaN(e)&&e>=0&&e<=m.height}};var C={useBackground:function(e){return e===true||e===false},backgroundColor:function(e){return typeof e=="string"&&e.substr(0,1)=="#"&&!isNaN(parseInt(e.substr(1),16))},backgroundOpacity:function(e){return!isNaN(e)&&e>=0&&e<=1},lockOrientation:function(e){return e===true||e===false},useCustomClose:function(e){return e===true||e===false},width:function(e){return typeof e=="number"&&e>0},height:function(e){return typeof e=="number"&&e>0}};var k={intensity:function(e){return!isNaN(e)},interval:function(e){return!isNaN(e)}};var L={state:function(e){console.log("STATE: "+o);if(o==t.UNKNOWN){console.log("TRYING TO SIGNAL ormma to ready");S=window.setInterval(window.ormma.signalReady,20);H(n.INFO,"controller initialized, attempting callback");H(n.MRAIDREADY,"controller initialized, attempting callback")}H(n.INFO,"setting state to "+_(e));o=e;H(n.STATECHANGE,o)},size:function(e){H(n.INFO,"setting size to "+_(e));u=e;H(n.SIZECHANGE,u.width,u.height)},defaultPosition:function(e){H(n.INFO,"setting default position to "+_(e));a=e},maxSize:function(e){H(n.INFO,"setting maxSize to "+_(e));f=e},expandProperties:function(e){H(n.INFO,"merging expandProperties with "+_(e));for(var t in e){expandProperties[t]=e[t]}},supports:function(e){H(n.INFO,"setting supports to "+_(e));l={};for(var t in i){l[i[t]]=P(i[t],e)}},heading:function(e){H(n.INFO,"setting heading to "+_(e));c=e;H(n.HEADINGCHANGE,c)},keyboardState:function(e){H(n.INFO,"setting keyboardState to "+_(e));h=e;H(n.KEYBOARDCHANGE,h)},location:function(e){H(n.INFO,"setting location to "+_(e));p=e;H(n.LOCATIONCHANGE,p.lat,p.lon,p.acc)},network:function(e){H(n.INFO,"setting network to "+_(e));d=e;H(n.NETWORKCHANGE,d!=s.OFFLINE&&d!=s.UNKNOWN,d)},orientation:function(e){H(n.INFO,"setting orientation to "+_(e));v=e;H(n.ORIENTATIONCHANGE,v)},screenSize:function(e){H(n.INFO,"setting screenSize to "+_(e));m=e;H(n.SCREENCHANGE,m.width,m.height)},shakeProperties:function(e){H(n.INFO,"setting shakeProperties to "+_(e));g=e},tilt:function(e){H(n.INFO,"setting tilt to "+_(e));y=e;H(n.TILTCHANGE,y.x,y.y,y.z)},cacheRemaining:function(e){H(n.INFO,"setting cacheRemaining to "+_(e));w=e},viewable:function(e){H(n.INFO,"setting viewable to "+_(e));E=e}};var A={};var O=function(e){this.event=e;this.count=0;var t={};this.add=function(n){var r=String(n);if(!t[r]){t[r]=n;this.count++;if(this.count==1)ormmaview.activate(e)}};this.remove=function(n){var r=String(n);if(t[r]){t[r]=null;delete t[r];this.count--;if(this.count==0)ormmaview.deactivate(e);return true}else{return false}};this.removeAll=function(){for(var e in t)this.remove(t[e])};this.broadcast=function(e){for(var n in t)t[n].apply({},e)};this.toString=function(){var n=[e,":"];for(var r in t)n.push("|",r,"|");return n.join("")}};ormmaview.addEventListener("change",function(e){for(var t in e){var n=L[t];n(e[t])}});ormmaview.addEventListener("shake",function(){H(n.SHAKE)});ormmaview.addEventListener("error",function(e,t){H(n.ERROR,e,t)});ormmaview.addEventListener("response",function(e,t){H(n.RESPONSE,e,t)});ormmaview.addEventListener("assetReady",function(e,t){b[e]=t;H(n.ASSETREADY,e)});ormmaview.addEventListener("assetRemoved",function(e){b[e]=null;delete b[e];H(n.ASSETREMOVED,e)});ormmaview.addEventListener("assetRetired",function(e){b[e]=null;delete b[e];H(n.ASSETRETIRED,e)});var M=function(e){var t=function(){};t.prototype=e;return new t};var _=function(e){if(typeof e=="object"){if(e.push){var t=[];for(var n in e){t.push(e[n])}return"["+t.join(",")+"]"}else{var t=[];for(var n in e){t.push("'"+n+"':"+e[n])}return"{"+t.join(",")+"}"}}else{return String(e)}};var D=function(e,t,r,i){if(i){if(e===undefined){H(n.ERROR,"Required object missing.",r);return false}else{for(var s in t){if(e[s]===undefined){H(n.ERROR,"Object missing required property "+s,r);return false}}}}for(var s in e){if(!t[s]){H(n.ERROR,"Invalid property specified - "+s+".",r);return false}else if(!t[s](e[s])){H(n.ERROR,"Value of property "+s+"<"+e[s]+">"+" is not valid type.",r);return false}}return true};var P=function(e,t){for(var n in t)if(t[n]==e)return true;return false};var H=function(){var e=new Array(arguments.length);for(var t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e.shift();if(r==n.ERROR){ormmaview.onError(e[0],e[1])}try{if(A[r])A[r].broadcast(e)}catch(i){}};var B=function(e){var t=0;var n=e.length-1;while(t<e.length&&e[t]==" "){t++}while(n>t&&e[n]==" "){n-=1}return e.substring(t,n+1)};e.signalReady=function(){if(typeof ORMMAReady=="function"){window.clearInterval(S);ORMMAReady();H(n.INFO,"callback invoked")}else{T+=20;if(T>=x){window.clearInterval(S)}}};e.addEventListener=function(e,t){if(!e||!t){H(n.ERROR,"Both event and listener are required.","addEventListener")}else if(!P(e,n)){H(n.ERROR,"Unknown event: "+e,"addEventListener")}else{if(!A[e])A[e]=new O(e);A[e].add(t);if(e==n.LOCATIONCHANGE){window.ormmaview.startLocationListener()}}};e.close=function(){ormmaview.close()};e.expand=function(e){H(n.INFO,"expanding");var t={x:0,y:0,width:ormmaview.getExpandProperties().width==0?f.width:ormmaview.getExpandProperties().width,height:ormmaview.getExpandProperties().height==0?f.height:ormmaview.getExpandProperties().height};ormmaview.expand(t,e)};e.getDefaultPosition=function(){return M(a)};e.getExpandProperties=function(){return M(ormmaview.getExpandProperties())};e.getMaxSize=function(){return M(f)};e.getSize=function(){return M(u)};e.getState=function(){return o};e.getViewable=function(){return E};e.hide=function(){if(o==t.HIDDEN){H(n.ERROR,"Ad is currently hidden.","hide")}else{ormmaview.hide()}};e.open=function(e,t){if(!e){H(n.ERROR,"URL is required.","open")}else{ormmaview.open(e,t)}};e.openMap=function(e,t){if(!e){H(n.ERROR,"POI is required.","openMap")}else{ormmaview.openMap(e,t)}};e.removeEventListener=function(e,t){if(!e){H(n.ERROR,"Must specify an event.","removeEventListener")}else{if(t&&(!A[e]||!A[e].remove(t))){H(n.ERROR,"Listener not currently registered for event","removeEventListener");return}else if(A[e]){A[e].removeAll();if(e==n.LOCATIONCHANGE){window.ormmaview.stopLocationListener()}}if(A[e]&&A[e].count==0){A[e]=null;delete A[e]}}};e.resize=function(e,t){if(e==null||t==null||isNaN(e)||isNaN(t)||e<0||t<0){H(n.ERROR,"Requested size must be numeric values between 0 and maxSize.","resize")}else if(e>f.width||t>f.height){H(n.ERROR,"Request ("+e+" x "+t+") exceeds maximum allowable size of ("+f.width+" x "+f.height+")","resize")}else if(e==u.width&&t==u.height){H(n.ERROR,"Requested size equals current size.","resize")}else{ormmaview.resize(e,t)}};e.setExpandProperties=function(t){tempProperties=ormmaview.getExpandProperties();if(t.useBackground!=undefined){if(t.useBackground===true||t.useBackground===false){tempProperties.useBackground=t.useBackground}}if(t.backgroundColor!=undefined){if(typeof t.backgroundColor=="string"&&t.backgroundColor.substr(0,1)=="#"&&!isNaN(parseInt(t.backgroundColor.substr(1),16))){tempProperties.backgroundColor=t.backgroundColor}}if(t.backgroundOpacity!=undefined){if(!isNaN(t.backgroundOpacity)&&t.backgroundOpacity>=0&&t.backgroundOpacity<=1){tempProperties.backgroundOpacity=t.backgroundOpacity}}if(t.lockOrientation!=undefined){if(t.lockOrientation===true||t.lockOrientation===false){tempProperties.lockOrientation=t.lockOrientation}}if(t.useCustomClose!=undefined){if(t.useCustomClose===true||t.useCustomClose===false){tempProperties.useCustomClose=t.useCustomClose;e.useCustomClose(t.useCustomClose)}}if(t.width!=undefined){if(typeof t.width=="number"&&t.width>0){tempProperties.width=t.width}}if(t.height!=undefined){if(typeof t.height=="number"&&t.height>0){tempProperties.height=t.height}}ormmaview.setExpandProperties(tempProperties)};e.show=function(){if(o!=t.HIDDEN){H(n.ERROR,"Ad is currently visible.","show")}else{ormmaview.show()}};e.playAudio=function(e,t){if(!l[i.AUDIO]){H(n.ERROR,"Method not supported by this client.","playAudio")}else if(!e||typeof e!="string"){H(n.ERROR,"Request must specify a URL","playAudio")}else{ormmaview.playAudio(e,t)}};e.playVideo=function(e,t){if(!l[i.VIDEO]){H(n.ERROR,"Method not supported by this client.","playVideo")}else if(!e||typeof e!="string"){H(n.ERROR,"Request must specify a URL","playVideo")}else{ormmaview.playVideo(e,t)}};e.createEvent=function(e,t,r){if(!l[i.CALENDAR]){H(n.ERROR,"Method not supported by this client.","createEvent")}else if(!e||typeof e!="object"||!e.getDate){H(n.ERROR,"Valid date required.","createEvent")}else if(!t||typeof t!="string"||B(t).length==0){H(n.ERROR,"Valid title required.","createEvent")}else if(!r||typeof r!="string"||B(r).length==0){H(n.ERROR,"Valid body required.","createEvent")}else{ormmaview.createEvent(e,t,r)}};e.getHeading=function(){if(!l[i.HEADING]){H(n.ERROR,"Method not supported by this client.","getHeading")}return c};e.getKeyboardState=function(){if(!l[i.LEVEL2]){H(n.ERROR,"Method not supported by this client.","getKeyboardState")}return h};e.getLocation=function(){if(!l[i.LOCATION]){H(n.ERROR,"Method not supported by this client.","getLocation")}return null==p?window.ormmaview.getLocation():M(p)};e.getNetwork=function(){if(!l[i.NETWORK]){H(n.ERROR,"Method not supported by this client.","getNetwork")}return d};e.getOrientation=function(){if(!l[i.ORIENTATION]){H(n.ERROR,"Method not supported by this client.","getOrientation")}return v};e.getScreenSize=function(){if(!l[i.SCREEN]){H(n.ERROR,"Method not supported by this client.","getScreenSize")}else{return null==m?null:M(m)}};e.getShakeProperties=function(){if(!l[i.SHAKE]){H(n.ERROR,"Method not supported by this client.","getShakeProperties")}else{return null==g?null:M(g)}};e.getTilt=function(){if(!l[i.TILT]){H(n.ERROR,"Method not supported by this client.","getTilt")}else{return null==y?null:M(y)}};e.makeCall=function(e){if(!l[i.PHONE]){H(n.ERROR,"Method not supported by this client.","makeCall")}else if(!e||typeof e!="string"||B(e).length==0){H(n.ERROR,"Request must provide a number to call.","makeCall")}else{ormmaview.makeCall(e)}};e.sendMail=function(e,t,r){if(!l[i.EMAIL]){H(n.ERROR,"Method not supported by this client.","sendMail")}else if(!e||typeof e!="string"||B(e).length==0){H(n.ERROR,"Request must specify a recipient.","sendMail")}else{ormmaview.sendMail(e,t,r)}};e.sendSMS=function(e,t){if(!l[i.SMS]){H(n.ERROR,"Method not supported by this client.","sendSMS")}else if(!e||typeof e!="string"||B(e).length==0){H(n.ERROR,"Request must specify a recipient.","sendSMS")}else{ormmaview.sendSMS(e,t)}};e.setShakeProperties=function(e){if(!l[i.SHAKE]){H(n.ERROR,"Method not supported by this client.","setShakeProperties")}else if(D(e,k,"setShakeProperties")){ormmaview.setShakeProperties(e)}};e.storePicture=function(e){ormmaview.storePicture(e)};e.supports=function(e){if(l[e]){return true}else{return false}};e.addAsset=function(e,t){if(!e||!t||typeof e!="string"||typeof t!="string"){H(n.ERROR,"URL and alias are required.","addAsset")}else if(l[i.LEVEL3]){ormmaview.addAsset(e,t);b[t]=e}else{b[t]=e;H(n.ASSETREADY,t)}};e.addAssets=function(t){for(var n in t){e.addAsset(t[n],n)}};e.getAssetURL=function(e){if(!b[e]){H(n.ERROR,"Alias unknown.","getAssetURL")}return ormmaview.getAssetURL(e)};e.getCacheRemaining=function(){if(!l[i.LEVEL3]){H(n.ERROR,"Method not supported by this client.","getCacheRemaining")}return ormmaview.getCacheRemaining()};e.request=function(e,t){console.log("request");if(!l[i.LEVEL3]){console.log("level 3 not supported");H(n.ERROR,"Method not supported by this client.","request");return true}else if(!e||typeof e!="string"){console.log("broken uri");H(n.ERROR,"URI is required.","request");return true}else{console.log("goto ormmabridge");ormmaview.request(e,t);return false}};e.removeAllAssets=function(){for(var t in b){e.removeAsset(t)}};e.useCustomClose=function(e){ormmaview.useCustomClose(e)};e.removeAsset=function(e){if(!e||typeof e!="string"){H(n.ERROR,"Alias is required.","removeAsset")}else if(!b[e]){H(n.ERROR,"Alias unknown.","removeAsset")}else if(l[i.LEVEL3]){ormmaview.removeAsset(e);delete b[e]}else{delete b[e];H(n.ASSETREMOVED,e)}}})()